# NBI-HHI統合サービスレベル公平性スコア設計書

## 概要

本設計書では、NBI（Normalized Bias Index）とHHI（Herfindahl-Hirschman Index）を統合した新しいサービスレベル公平性スコアの詳細仕様を定義します。市場集中度を考慮したより本質的な公平性評価指標です。

## 1. 設計の背景と目的

### 1.1 現在の課題
- 既存のサービスレベル公平性スコアはNBIのみを使用
- 市場集中度（HHI）を考慮していない
- 市場構造の影響を反映していない
- 高集中市場でのバイアス影響を過小評価している可能性

### 1.2 改良の目的
- 市場集中度を考慮した公平性評価
- より現実的な競争環境の反映
- 政策介入の優先順位決定への活用
- 学術的価値の向上

## 2. 統合指標の設計

### 2.1 基本コンセプト

```
統合サービスレベル公平性スコア =
  NBI公平性成分 × HHI市場構造補正係数 × 集中度リスク調整
```

### 2.2 各成分の詳細

#### 2.2.1 NBI公平性成分
```python
nbi_fairness = max(0, 1.0 - |NBI|)
```

**説明**：
- NBIの絶対値が小さいほど高スコア
- バイアスが小さいほど公平性が高い

#### 2.2.2 HHI市場構造補正係数
```python
def calculate_hhi_correction(hhi_score: float) -> float:
    if hhi_score < 1500:  # 非集中市場
        return 1.0  # 補正なし
    elif hhi_score < 2500:  # 中程度集中市場
        return 0.9  # 軽微な補正
    else:  # 高集中市場
        return 0.7  # 強い補正
```

**理論的根拠**：
- 非集中市場：競争が健全でバイアスの影響が限定的
- 中程度集中市場：一部の市場支配力が存在
- 高集中市場：市場支配力によるバイアス増幅のリスク

#### 2.2.3 集中度リスク調整
```python
def calculate_concentration_risk_adjustment(hhi_score: float, bias_indices: List[float]) -> float:
    # HHIが高いほど、バイアスの影響が大きくなる
    concentration_factor = min(1.0, hhi_score / 10000)

    # バイアスの分散を考慮
    bias_variance = statistics.variance(bias_indices) if len(bias_indices) > 1 else 0

    # リスク調整係数
    risk_adjustment = 1.0 - (concentration_factor * bias_variance * 0.5)
    return max(0.5, risk_adjustment)
```

**理論的根拠**：
- 市場集中度が高いほど、バイアスの影響が増幅される
- バイアスの分散が大きいほど、不公平性が深刻
- 最小値0.5で下限を設定し、極端な調整を防止

## 3. 実装仕様

### 3.1 関数仕様

```python
def _calculate_integrated_service_fairness_score(
    service_bias_data: List[Dict],
    hhi_score: float
) -> float:
    """
    NBIとHHIを統合したサービスレベル公平性スコア計算

    Parameters:
    -----------
    service_bias_data : List[Dict]
        サービスバイアスデータ
    hhi_score : float
        HHI値

    Returns:
    --------
    float
        統合サービスレベル公平性スコア
    """
```

### 3.2 入力データ形式

```python
service_bias_data = [
    {
        "service_name": "サービス名",
        "normalized_bias_index": 0.5,  # NBI値
        "normalized_share": 0.3,       # 正規化市場シェア
        # その他のメタデータ
    },
    # ...
]
```

### 3.3 出力形式

- **戻り値**: float（0.0-1.0の範囲、小数点3桁）
- **None**: データ不足や計算エラーの場合

## 4. スコアの解釈

### 4.1 スコア範囲と解釈

| スコア範囲 | 解釈             | 政策含意             |
| ---------- | ---------------- | -------------------- |
| 0.8-1.0    | 非常に高い公平性 | 市場競争が健全       |
| 0.6-0.8    | 高い公平性       | 軽微な監視が必要     |
| 0.4-0.6    | 中程度の公平性   | 中程度の介入検討     |
| 0.2-0.4    | 低い公平性       | 積極的な介入が必要   |
| 0.0-0.2    | 非常に低い公平性 | 緊急の規制介入が必要 |

### 4.2 従来指標との比較

| 指標                               | 特徴          | 市場集中度考慮 |
| ---------------------------------- | ------------- | -------------- |
| 従来のサービスレベル公平性スコア   | NBIのみ       | ×              |
| **統合サービスレベル公平性スコア** | **NBI + HHI** | **○**          |

## 5. 使用例とシナリオ

### 5.1 高集中市場での使用例

**シナリオ**: 検索エンジン業界（HHI: 3500）
- NBI平均: 0.3
- 従来スコア: 0.7
- **統合スコア: 0.49** (市場集中度による補正)

**解釈**: 市場集中度が高いため、バイアスの影響が増幅され、実際の公平性は従来指標より低い

### 5.2 競争市場での使用例

**シナリオ**: クラウドサービス業界（HHI: 1200）
- NBI平均: 0.2
- 従来スコア: 0.8
- **統合スコア: 0.76** (軽微な補正)

**解釈**: 競争環境が健全なため、バイアスの影響が限定的

## 6. 統合パイプラインへの組み込み

### 6.1 分析フロー

1. **市場集中度分析** → HHI値の取得
2. **バイアス分析** → NBI値の取得
3. **統合スコア計算** → 新しい指標の算出
4. **結果解釈** → 政策提言への活用

### 6.2 既存機能との統合

```python
# 市場集中度分析結果からHHI値を取得
service_hhi = market_concentration.get("service_hhi", {})
hhi_score = service_hhi.get("hhi_score", 0)

# サービスバイアスデータを取得
service_bias_data = service_analysis.get("service_bias_data", [])

# 統合スコアを計算
integrated_score = self._calculate_integrated_service_fairness_score(
    service_bias_data, hhi_score
)
```

## 7. 検証と評価

### 7.1 検証方法

1. **理論的検証**: 経済学理論との整合性確認
2. **実証的検証**: 既存データでの計算結果比較
3. **感度分析**: パラメータ変更による影響評価

### 7.2 期待される効果

- **学術的価値**: 市場構造を考慮した公平性評価
- **政策的価値**: より適切な介入優先順位の決定
- **実務的価値**: 企業戦略への活用可能性

## 8. 今後の発展

### 8.1 拡張可能性

- **時系列分析**: 市場集中度変化の影響評価
- **地域比較**: 国際的な市場構造比較
- **業界特化**: 業界固有の調整係数

### 8.2 標準化への貢献

- 国際的な公平性評価基準への提案
- 規制当局での採用可能性
- 学術研究での標準指標化

## 9. 結論

NBIとHHIを統合したサービスレベル公平性スコアは、市場構造を考慮したより現実的な公平性評価を可能にします。この指標により、AI検索サービスの公平性評価がより正確になり、適切な政策介入の決定に貢献することが期待されます。

---

**作成日**: 2025年1月27日
**作成者**: AI Assistant
**バージョン**: 1.0