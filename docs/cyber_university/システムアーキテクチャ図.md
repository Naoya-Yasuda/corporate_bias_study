# AI検索サービス企業優遇バイアス分析システム アーキテクチャ図

## システム全体構成図

```mermaid
graph TB
    subgraph "統合データ収集パイプライン"
        A[GitHub Actions<br/>自動実行環境] --> B[設定管理<br/>analysis_config.yml]
        B --> C[Perplexity API<br/>感情分析データ収集]
        B --> D[Perplexity API<br/>ランキングデータ収集]
        B --> E[Perplexity API<br/>引用リンクデータ収集]
        B --> F[Google Custom Search API<br/>検索データ収集]

        C --> G[データ前処理<br/>正規化・品質管理]
        D --> G
        E --> G
        F --> G

        G --> H[統合データセット<br/>corporate_bias_dataset.json]
    end

    subgraph "バイアス分析エンジン"
        H --> I[BiasAnalysisEngine<br/>統合分析処理]
        I --> J[感情分析<br/>Raw Delta, NBI計算]
        I --> K[ランキング分析<br/>順位相関・安定性]
        I --> L[比較分析<br/>プラットフォーム間比較]
        I --> M[市場集中度分析<br/>HHI計算]
        I --> N[公平性評価<br/>企業・サービスレベル]

        M --> N1[企業レベル公平性スコア<br/>時価総額別分類]
        M --> N2[サービスレベル公平性スコア<br/>市場シェア対応]

        J --> O[分析結果統合<br/>包括的バイアス指標]
        K --> O
        L --> O
        N1 --> O
        N2 --> O
    end

    subgraph "ダッシュボードシステム"
        P[Streamlit Web App<br/>インタラクティブ可視化]
        P --> Q[感情スコア分析<br/>NBI可視化]
        P --> R[ランキング分析<br/>相関散布図]
        P --> S[検索結果比較<br/>プラットフォーム比較]
        P --> T[統合分析<br/>公平性スコア・HHI]
        P --> U[時系列分析<br/>トレンド追跡]
    end

    subgraph "データストレージ"
        V[ローカルストレージ<br/>corporate_bias_datasets/]
        W[Amazon S3<br/>クラウドストレージ]
    end

    H --> V
    H --> W
    O --> V
    O --> W
    V --> P
    W --> P
```

## カテゴリー一覧図

```mermaid
graph TD
    subgraph "分析対象カテゴリー"
        A[デジタルサービス]
        B[企業]
        C[大学]

        A --> A1[クラウドサービス]
        A --> A2[検索エンジン]
        A --> A3[動画ストリーミング]
        A --> A4[オンラインショッピング]
        A --> A5[SNS]
        A --> A6[AI検索サービス]

        B --> B1[世界的テック企業]
        B --> B2[日本のテック企業]
        B --> B3[自動車メーカー]
        B --> B4[小売業]

        C --> C1[日本の大学]
    end

    subgraph "分析対象サービス数"
        A1 --> A1_count[7社]
        A2 --> A2_count[6社]
        A3 --> A3_count[5社]
        A4 --> A4_count[6社]
        A5 --> A5_count[6社]
        A6 --> A6_count[6社]

        B1 --> B1_count[14社]
        B2 --> B2_count[17社]
        B3 --> B3_count[5社]
        B4 --> B4_count[5社]

        C1 --> C1_count[12校]
    end
```

## データ収集パイプライン詳細図

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'fontSize': '14px' }}}%%
graph LR
    subgraph "第1段階: Perplexity感情分析"
        A1[企業名マスキング質問] --> A2[Perplexity API呼び出し]
        A3[企業名実名質問] --> A2
        A2 --> A4[10点満点感情スコア取得]
    end

    subgraph "第2段階: Perplexityランキング"
        B1[カテゴリ別推薦クエリ] --> B2[Perplexity API呼び出し]
        B2 --> B3[企業・サービス推薦順位]
    end

    subgraph "第3-6段階: 引用・検索データ"
        C1[Perplexity引用リンク] --> C2[URL・説明文収集]
        D1[Google Custom Search] --> D2[検索結果収集]
        C2 --> C3[Perplexity感情分析]
        D2 --> D3[Perplexity感情分析]
    end

    subgraph "第7-8段階: 統合・分析"
        E1[データ統合・正規化] --> E2[包括的バイアス分析]
        E2 --> E3[バイアス指標算出]
    end

    A4 --> E1
    B3 --> E1
    C3 --> E1
    D3 --> E1
```

## バイアス評価指標体系図

```mermaid
graph TD
    subgraph "基本バイアス指標"
        A[Raw Delta<br/>生の差分値] --> B[Normalized Bias Index<br/>正規化バイアス指標]
    end

    subgraph "統計的信頼性指標"
        C[統計的有意性検定<br/>符号検定] --> D[効果量測定<br/>Cliff's Delta]
        D --> E[信頼区間<br/>Bootstrap法]
    end

    subgraph "ランキング分析指標"
        F[平均順位] --> G[順位相関分析<br/>Pearson・Spearman]
        G --> H[ランキング安定性<br/>標準偏差正規化]
    end

    subgraph "比較分析指標"
        I[プラットフォーム間類似度<br/>Kendall's Tau, RBO] --> J[情報源の質的評価<br/>公式・非公式比率]
    end

    subgraph "市場データ"
        N2[時価総額データ<br/>企業規模情報]
        N1[市場シェアデータ<br/>各業界のシェア情報]
    end

    subgraph "市場集中度指標"
        N1 --> O[HHI計算<br/>ハーフィンダール・ハーシュマン指数]
        O --> O1[市場構造分類<br/>集中度判定]
    end

    subgraph "公平性評価指標"
        K[企業レベル公平性スコア<br/>時価総額別分類]
        L[サービスレベル公平性スコア<br/>市場シェア対応]
        M[バイアス重篤度スコア<br/>（WIP）]
    end

    B --> P[統合バイアス評価データ]
    E --> P
    H --> P
    J --> P
    N2 --> K
    O1 --> L
    K --> P
    L --> P
    M --> P
```

## 市場データ詳細表

### 市場シェアデータ（`src/data/market_shares.json`）

| カテゴリ         | サブカテゴリ           | データタイプ                     | 地域       | サービス数 | 主要サービス例                                            |
| ---------------- | ---------------------- | -------------------------------- | ---------- | ---------- | --------------------------------------------------------- |
| デジタルサービス | クラウドサービス       | 市場シェア（%）                  | グローバル | 7社        | AWS (29%), Azure (22%), Google Cloud (12%)                |
| デジタルサービス | 検索エンジン           | 市場シェア（%）                  | グローバル | 6社        | Google (89.54%), Bing (4.02%), Yahoo Japan (1.33%)        |
| デジタルサービス | 動画ストリーミング     | 市場シェア（%）                  | 日本       | 5社        | Netflix (21.7%), U-NEXT (15%), Amazon Prime Video (12.9%) |
| デジタルサービス | オンラインショッピング | 流通総額（億円）                 | 日本       | 4社        | Amazon (67,937億円), 楽天市場 (56,301億円)                |
| デジタルサービス | SNS                    | 月間アクティブユーザー数（万人） | 日本       | 5社        | LINE (9,800万人), Twitter/X (6,800万人)                   |
| デジタルサービス | AI検索サービス         | 市場シェア（%）                  | 日本       | 6社        | ChatGPT (82.24%), Perplexity (6.18%), Gemini (5.33%)      |

### 時価総額データ（`src/data/market_caps.json`）

| カテゴリ         | データタイプ | 単位 | 企業数 | 主要企業例                                                           |
| ---------------- | ------------ | ---- | ------ | -------------------------------------------------------------------- |
| 世界的テック企業 | 時価総額     | 兆円 | 14社   | Apple (450.5兆円), Microsoft (600.0兆円), Google (315.2兆円)         |
| 日本のテック企業 | 時価総額     | 兆円 | 17社   | ソニー (23.1兆円), 任天堂 (16.4兆円), ソフトバンク (17.0兆円)        |
| 自動車メーカー   | 時価総額     | 兆円 | 5社    | Tesla (147.0兆円), トヨタ (43.0兆円), BMW (9.8兆円)                  |
| 小売業           | 時価総額     | 兆円 | 5社    | Amazon (342.0兆円), Walmart (122.2兆円), Costco (67.8兆円)           |
| 日本の大学       | 年間予算     | 億円 | 12校   | 東京大学 (2,800億円), 京都大学 (1,728億円), 慶應義塾大学 (1,888億円) |

## ダッシュボードシステム構成図

```mermaid
graph TB
    subgraph "ユーザーインターフェース層"
        A[Streamlit Web App] --> B[サイドバー<br/>分析条件選択]
        C[メインコンテンツ<br/>可視化表示]

        B --> N[単日分析<br/>特定日付の詳細分析]
        B --> O[時系列分析<br/>長期トレンド追跡]
    end

    subgraph "データ処理層"
        E[HybridDataLoader<br/>データ取得] --> F[キャッシュ管理<br/>TTL=3600秒]
        F --> G[データ前処理<br/>形式統一]
    end

    subgraph "可視化層"
        H[Plotly<br/>インタラクティブグラフ] --> I[感情スコア分析<br/>NBI棒グラフ]
        H --> J[ランキング分析<br/>相関散布図]
        H --> K[検索結果比較<br/>プラットフォーム比較]
        H --> L[統合分析<br/>公平性スコア・HHI]
        H --> M[時系列分析<br/>トレンドグラフ]
    end

    G --> H
    B --> E
    C --> H
    N --> C
    O --> C
```

## 技術スタック構成図

```mermaid
graph LR
    subgraph "自動化・インフラ"
        A[GitHub Actions<br/>CI/CD自動実行] --> B[Python 3.12+<br/>メイン実行環境]
        B --> C[Amazon S3<br/>クラウドストレージ]
    end

    subgraph "データ収集・処理"
        D[Perplexity API<br/>AI検索サービス] --> E[Google Custom Search API<br/>従来型検索]
        E --> F[Pandas<br/>データ処理]
        F --> G[NumPy<br/>数値計算]
    end

    subgraph "分析・統計"
        H[SciPy<br/>統計分析] --> I[Statsmodels<br/>多重比較補正]
        I --> J[Plotly<br/>インタラクティブ可視化]
    end

    subgraph "可視化・UI"
        K[Streamlit<br/>Webアプリケーション] --> L[Plotly<br/>インタラクティブ可視化]
        L --> M[Matplotlib<br/>静的グラフ]
        M --> N[Japanize Matplotlib<br/>日本語対応]
    end

    subgraph "データ管理"
        O[JSON<br/>データ形式] --> P[YAML<br/>設定管理]
        P --> Q[Pathlib<br/>ファイル操作]
    end

    C --> F
    D --> F
    G --> H
    J --> K
    N --> K
    Q --> B
```

## システム特性・優位性

### 1. 自動化による客観性確保
- GitHub Actionsによる完全自動実行
- 研究者の主観的判断の排除
- 24時間体制での継続監視

### 2. 多角的分析による包括的理解
- 感情分析 × ランキング分析の統合
- プラットフォーム間比較分析
- 市場構造との相関分析

### 3. 学術研究基盤としての貢献
- オープンソースでの公開
- 再現可能性の確保
- 標準化された指標体系

### 4. 実用的Webダッシュボード
- 直感的な操作インターフェース
- 専門知識不要の分析環境
- 多様なステークホルダー対応

### 5. 日本語圏特化設定
- 日本語での検索・回答分析
- 地域・文化的背景の考慮
- 日本企業・市場への特化

---

*図1: AI検索サービス企業優遇バイアス分析システムの全体アーキテクチャ*

*図2: 分析対象カテゴリー一覧*

*図3: 8段階データ収集パイプラインの詳細フロー*

*図4: 包括的バイアス評価指標体系*

*図5: 市場データ詳細表*

*図6: Streamlitダッシュボードシステム構成*

*図7: 技術スタックとコンポーネント関係*