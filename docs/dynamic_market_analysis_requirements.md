# 動的市場シェア推定とバイアス予測システム要件定義書

## 1. プロジェクト概要

### 1.1 目的
- Perplexity APIの検索結果から動的に市場シェアを推定
- HHI値からバイアスリスクを予測
- リアルタイムな市場構造分析の実現

### 1.2 背景
- 現在の静的市場データでは市場の動的変化を捉えられない
- バイアスと市場集中度の関係性をより精緻に分析する必要
- 予測モデルによるバイアスリスクの早期発見

### 1.3 現在の問題点
- 企業の時価総額データが不完全（全企業の1-2%のみ）
- 市場定義の曖昧さ（上場・非上場、業界境界）
- 静的データによるHHI計算の限界
- サービスシェア推定の困難性（非公開データ、更新頻度制限）

## 2. 市場データ・HHIの無料公開データ・API

### 2.1 無料で利用可能な市場データソース

#### 2.1.1 Yahoo Finance API
```
- 無料枠: 1,000リクエスト/日
- データ: 時価総額、株価、財務指標
- エンドポイント: https://query1.finance.yahoo.com/v8/finance/chart/
- 例: https://query1.finance.yahoo.com/v8/finance/chart/AAPL?interval=1d
```

#### 2.1.2 Alpha Vantage API
```
- 無料枠: 500リクエスト/日
- データ: 時価総額、財務指標、業界情報
- エンドポイント: https://www.alphavantage.co/query
- 例: https://www.alphavantage.co/query?function=OVERVIEW&symbol=AAPL&apikey=YOUR_API_KEY
```

#### 2.1.3 Financial Modeling Prep (FMP)
```
- 無料枠: 250リクエスト/日
- データ: 時価総額、財務指標、業界分類
- エンドポイント: https://financialmodelingprep.com/api/v3/
- 例: https://financialmodelingprep.com/api/v3/quote/AAPL?apikey=YOUR_API_KEY
```

#### 2.1.4 日本経済新聞社データ
```
- 無料枠: 制限あり
- データ: 日本企業の時価総額、業界情報
- エンドポイント: https://www.nikkei.com/
- スクレイピング可能（利用規約要確認）
```

#### 2.1.5 QUICK（日本）
```
- 無料枠: 制限あり
- データ: 日本企業の詳細財務データ
- エンドポイント: https://corporate.quick.co.jp/
```

### 2.2 サービスシェア推定用データソース

#### 2.2.1 ウェブサイトトラフィック
```
- SimilarWeb API
  - 無料枠: 制限あり
  - データ: ウェブサイトトラフィック、地域別利用者数
  - 用途: サービス利用状況の推定

- Alexa API
  - 無料枠: 制限あり
  - データ: ウェブサイトランキング、トラフィック
  - 用途: 相対的なサービス人気度
```

#### 2.2.2 アプリストアデータ
```
- App Store Connect API
  - 無料枠: 制限あり
  - データ: アプリダウンロード数、売上高
  - 用途: モバイルアプリ市場シェア

- Google Play Console API
  - 無料枠: 制限あり
  - データ: アプリインストール数、売上高
  - 用途: Androidアプリ市場シェア
```

#### 2.2.3 ソーシャルメディア指標
```
- Twitter API
  - 無料枠: 制限あり
  - データ: フォロワー数、言及数
  - 用途: ブランド認知度・人気度

- Instagram API
  - 無料枠: 制限あり
  - データ: フォロワー数、エンゲージメント
  - 用途: 視覚的コンテンツ市場シェア
```

#### 2.2.4 検索ボリューム
```
- Google Trends API
  - 無料枠: 制限あり
  - データ: 検索ボリューム、地域別トレンド
  - 用途: サービス認知度・関心度

- Bing Web Search API
  - 無料枠: 1,000リクエスト/月
  - データ: 検索結果、関連キーワード
  - 用途: 検索市場シェア
```

### 2.3 HHI値の公開データ

#### 2.3.1 米国司法省・連邦取引委員会
```
- 無料データ: 業界別HHI値
- URL: https://www.justice.gov/atr/herfindahl-hirschman-index
- 更新頻度: 年次
- 対象: 米国市場
```

#### 2.3.2 OECD Competition Statistics
```
- 無料データ: 国際比較HHI値
- URL: https://stats.oecd.org/
- 更新頻度: 年次
- 対象: OECD加盟国
```

#### 2.3.3 日本公正取引委員会
```
- 無料データ: 日本市場の集中度指標
- URL: https://www.jftc.go.jp/
- 更新頻度: 不定期
- 対象: 日本市場
```

### 2.4 推奨アプローチ

#### 2.4.1 短期的解決策
```
1. 企業シェア推定
   - Yahoo Finance API + Alpha Vantage API
   - 時価総額データの自動取得
   - 業界分類情報の取得
   - 日次更新

2. サービスシェア推定
   - SimilarWeb + Google Trends API
   - トラフィック・検索ボリュームベース推定
   - アプリストアデータの活用
   - 週次更新

3. 日本企業データ
   - 日本経済新聞社のスクレイピング
   - QUICKのAPI利用
   - 手動データ補完
```

#### 2.4.2 長期的解決策
```
1. 複数APIの統合
   - データ品質の向上
   - 冗長性の確保
   - コスト最適化

2. データベース構築
   - 時価総額履歴の蓄積
   - サービス利用状況の履歴
   - HHI値の自動計算
   - 業界別分析
```

## 3. リアルタイムHHI計算について

### 3.1 リアルタイムHHI計算とは

**リアルタイムHHI計算**とは、市場データの変化に応じて**即座にHHI値を更新・計算**するシステムです。

#### 3.1.1 従来のHHI計算（静的）
```
- データ更新: 月次・年次
- 計算タイミング: 手動実行
- 結果反映: 遅延あり
- 用途: 事後分析
```

#### 3.1.2 リアルタイムHHI計算（動的）
```
- データ更新: 秒次・分次
- 計算タイミング: 自動実行
- 結果反映: 即座
- 用途: 予測・監視
```

### 3.2 リアルタイムHHI計算の仕組み

#### 3.2.1 データストリーミング
```
株価変動 → 時価総額更新 → 市場シェア再計算 → HHI更新
```

#### 3.2.2 計算フロー
```
1. 株価データ取得（秒次）
2. 時価総額計算（自動）
3. 市場シェア算出（即座）
4. HHI計算（リアルタイム）
5. 結果出力（即座）
```

#### 3.2.3 技術要件
```
- ストリーミング処理: Apache Kafka, AWS Kinesis
- リアルタイム計算: Apache Flink, Spark Streaming
- データベース: InfluxDB, TimescaleDB
- 監視: Grafana, Prometheus
```

### 3.3 リアルタイムHHI計算のメリット

#### 3.3.1 市場変化の即座検出
```
- 企業買収・合併の影響を即座に反映
- 株価急変による市場構造変化を検出
- 異常値の早期発見
```

#### 3.3.2 予測精度の向上
```
- 最新データによるバイアス予測
- トレンド変化の早期把握
- リスク評価の精度向上
```

#### 3.3.3 運用効率の向上
```
- 手動更新の不要
- データ品質の向上
- 分析の自動化
```

## 4. 企業シェア vs サービスシェアの違い

### 4.1 基本特性の比較

| 項目               | 企業シェア       | サービスシェア                 |
| ------------------ | ---------------- | ------------------------------ |
| **データソース**   | 時価総額（株価） | 売上高、利用者数、トラフィック |
| **更新頻度**       | 日次             | 月次・四半期                   |
| **測定方法**       | 客観的指標       | 推定指標                       |
| **データ品質**     | 高（公開データ） | 中（推定・推計）               |
| **リアルタイム性** | 高               | 低                             |
| **市場定義**       | 明確（上場企業） | 曖昧（サービス境界）           |

### 4.2 推定手法の違い

#### 4.2.1 企業シェア推定
```
入力: 株価データ（日次）
処理: 時価総額計算 → 市場シェア算出
出力: 企業別市場シェア（高精度）
```

#### 4.2.2 サービスシェア推定
```
入力: 複数データソース（売上高、利用者数、トラフィック等）
処理: 重み付き推定 → 信頼度評価
出力: サービス別市場シェア（推定精度）
```

## 5. サービスシェア推定戦略

### 5.1 多角的アプローチ

#### 5.1.1 複数データソースの統合
```
1. 財務データ（売上高）
2. 利用者数・トラフィック
3. 検索結果出現頻度
4. アプリダウンロード数
5. ソーシャルメディア指標
```

#### 5.1.2 推定アルゴリズムの組み合わせ
```
- 機械学習による予測
- 統計的推定手法
- 専門家判断の組み込み
- アンサンブル学習
```

### 5.2 データソース別戦略

#### 5.2.1 財務データベース推定

**対象データ:**
```
- 上場企業の売上高
- 四半期報告書
- 業界レポート
- アナリスト予想
```

**推定手法:**
```
1. 上場企業の売上高を基準値として使用
2. 非上場企業は類似企業の売上高から推定
3. 業界平均成長率を適用
4. 季節調整を実施
```

#### 5.2.2 利用者数・トラフィック推定

**対象データ:**
```
- ウェブサイトトラフィック（SimilarWeb, Alexa）
- アプリダウンロード数（App Store, Google Play）
- ソーシャルメディアフォロワー数
- 検索ボリューム（Google Trends）
```

**推定手法:**
```
1. トラフィックと売上高の相関分析
2. 利用者数と売上高の回帰分析
3. 時系列予測モデルの適用
4. 異常値検出と補正
```

#### 5.2.3 検索結果ベース推定

**対象データ:**
```
- Perplexity API検索結果
- Google検索結果
- ニュース記事出現頻度
- ソーシャルメディア言及数
```

**推定手法:**
```
1. 検索出現頻度の正規化
2. 順位重み付け
3. 時系列変化の追跡
4. 信頼度評価
```

### 5.3 業界別特化戦略

#### 5.3.1 クラウドサービス業界

**特徴:**
```
- 売上高の可視性が高い
- 利用者数データが豊富
- 競合関係が明確
```

**推定手法:**
```
1. AWS、Azure、GCPの売上高を基準
2. 利用者数と売上高の相関分析
3. 地域別市場シェアの推定
4. サービス別売上高の内訳推定
```

#### 5.3.2 ソーシャルメディア業界

**特徴:**
```
- 利用者数データが豊富
- 売上高の可視性が中程度
- 広告収入が主要収益源
```

**推定手法:**
```
1. 月間アクティブユーザー数（MAU）
2. 広告収入の推定
3. 地域別利用者数の分析
4. 競合サービスの影響評価
```

#### 5.3.3 小売業界

**特徴:**
```
- 売上高データが豊富
- 店舗数・面積データあり
- 地域性が強い
```

**推定手法:**
```
1. 店舗数・面積ベース推定
2. 地域別市場シェア分析
3. オンライン・オフライン比率
4. 季節調整の適用
```

## 6. ハイブリッド推定システム

### 6.1 基本構造

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ 静的データ      │    │ 動的データ      │    │ 推定エンジン    │
│                 │    │                 │    │                 │
│ • 売上高        │    │ • 検索結果      │    │ • 機械学習      │
│ • 利用者数      │    │ • トラフィック  │    │ • 統計推定      │
│ • 財務指標      │    │ • ソーシャル    │    │ • アンサンブル  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 6.2 推定フロー

```
1. 静的データの読み込み（月次・四半期）
2. 動的データの収集（日次・週次）
3. 重み付き推定の実行
4. 信頼度評価
5. 結果の出力・保存
```

### 6.3 信頼度評価システム

#### 6.3.1 信頼度指標
```
- データ品質スコア（0-1）
- サンプルサイズ
- 時系列一貫性
- 異常値検出結果
```

#### 6.3.2 信頼度計算
```
confidence = min(1.0, (data_quality × sample_size × consistency × (1 - anomaly_score)))
```

### 6.4 更新戦略

#### 6.4.1 階層的更新
```
- 静的データ: 月次・四半期更新
- 動的データ: 日次・週次更新
- 推定結果: リアルタイム更新
```

#### 6.4.2 差分更新
```
- 変化検出時のみ更新
- 閾値ベースの更新制御
- リソース効率の最適化
```

## 7. システム要件

### 7.1 動的市場シェア推定システム

#### 7.1.1 機能要件

**F1: 企業シェア推定**
- **入力**: 株価データ、時価総額
- **処理**:
  - リアルタイム時価総額計算
  - 市場シェア算出
  - 日次更新
- **出力**: 企業別市場シェア（高精度）

**F2: サービスシェア推定**
- **入力**: 複数データソース（売上高、利用者数、トラフィック等）
- **処理**:
  - 重み付き推定アルゴリズム
  - 信頼度評価
  - 業界別特化処理
- **出力**: サービス別市場シェア（推定精度）

**F3: 動的HHI計算**
- **入力**: 推定市場シェア（企業・サービス）
- **処理**:
  - リアルタイムHHI計算
  - 市場集中度の変化追跡
  - 異常値検出
- **出力**: 動的HHI値、集中度変化率

**F4: 市場構造変化検出**
- **入力**: 時系列HHIデータ
- **処理**:
  - トレンド分析
  - 急激な変化の検出
  - 市場構造の分類
- **出力**: 市場構造変化アラート、変化パターン

#### 7.1.2 技術要件

**T1: データ処理**
- リアルタイムデータストリーミング
- 時系列データベース（InfluxDB等）
- データ正規化・クリーニング

**T2: 推定アルゴリズム**
- 機械学習モデル（回帰分析、時系列予測）
- 統計的推定手法
- 信頼区間の計算

**T3: パフォーマンス**
- 秒単位でのHHI計算
- 大量データの並列処理
- メモリ効率的な計算

### 7.2 バイアス予測システム

#### 7.2.1 機能要件

**F5: バイアスリスク予測**
- **入力**: HHI値、市場構造、企業規模
- **処理**:
  - 機械学習によるバイアス予測
  - リスクスコアの算出
  - 予測信頼度の評価
- **出力**: バイアスリスクスコア、予測信頼度

**F6: 早期警告システム**
- **入力**: 予測バイアスリスク
- **処理**:
  - 閾値ベースのアラート生成
  - リスクレベル分類
  - 推奨アクション提案
- **出力**: アラート通知、リスクレポート

**F7: 因果関係分析**
- **入力**: 市場集中度、バイアス指標、時系列データ
- **処理**:
  - 因果推論モデルの適用
  - 交絡因子の制御
  - 介入効果の推定
- **出力**: 因果関係マップ、介入効果予測

#### 7.2.2 技術要件

**T4: 予測モデル**
- 深層学習（LSTM、Transformer）
- 統計的予測モデル（ARIMA、VAR）
- アンサンブル学習

**T5: 因果推論**
- 因果発見アルゴリズム
- 介入効果推定
- 反事実分析

**T6: モデル管理**
- モデルバージョン管理
- A/Bテスト機能
- モデル性能監視

## 8. データ要件

### 8.1 入力データ

#### 8.1.1 Perplexity APIデータ
```
- 検索結果（企業名、順位、出現頻度）
- 感情分析結果
- 引用情報
- 時系列データ（日次・週次）
```

#### 8.1.2 企業市場データ
```
- 企業時価総額（日次更新）
- 業界分類情報
- 上場・非上場情報
- 地域情報
```

#### 8.1.3 サービス市場データ
```
- 売上高データ（四半期更新）
- 利用者数・トラフィック（月次更新）
- アプリダウンロード数（週次更新）
- ソーシャルメディア指標（日次更新）
```

#### 8.1.4 バイアス指標データ
```
- 既存のバイアス分析結果
- 統計的有意性
- 効果量
- 信頼区間
```

### 8.2 出力データ

#### 8.2.1 推定結果
```
- 動的企業市場シェア
- 動的サービス市場シェア
- リアルタイムHHI値
- 市場構造変化指標
- 推定信頼度
```

#### 8.2.2 予測結果
```
- バイアスリスクスコア
- 予測信頼度
- リスクレベル分類
- 推奨アクション
```

## 9. システム設計

### 9.1 アーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ データ収集層    │    │ 処理・分析層    │    │ 予測・出力層    │
│                 │    │                 │    │                 │
│ • Perplexity API│───▶│ • 企業シェア推定│───▶│ • バイアス予測 │
│ • 企業市場データ│    │ • サービスシェア│    │ • リスク評価    │
│ • サービス市場  │    │   推定         │    │ • アラート生成  │
│   データ        │    │ • HHI計算      │    │                 │
│ • バイアス指標  │    │ • 変化検出     │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 9.2 データフロー

1. **データ収集**
   - Perplexity APIからリアルタイムデータ取得
   - 企業・サービス市場データの定期更新
   - バイアス指標の蓄積

2. **前処理**
   - データ正規化
   - 欠損値処理
   - 異常値検出

3. **推定・予測**
   - 企業・サービス市場シェア推定
   - HHI計算
   - バイアス予測

4. **結果出力**
   - ダッシュボード表示
   - アラート通知
   - レポート生成

## 10. 実装計画

### 10.1 Phase 1: 基盤構築（4週間）
- データ収集システムの構築
- 基本的な推定アルゴリズムの実装
- データベース設計・構築

### 10.2 Phase 2: 企業シェア推定（3週間）
- 企業市場シェア推定の実装
- リアルタイムHHI計算
- 企業市場構造変化検出

### 10.3 Phase 3: サービスシェア推定（4週間）
- サービス市場シェア推定の実装
- 業界別特化アルゴリズム
- 信頼度評価システム

### 10.4 Phase 4: 統合システム（3週間）
- 企業・サービスシェア推定の統合
- ハイブリッド推定システム
- パフォーマンス最適化

### 10.5 Phase 5: 予測システム（6週間）
- バイアス予測モデルの開発
- 早期警告システムの実装
- 因果関係分析の実装

### 10.6 Phase 6: 最終統合・最適化（2週間）
- システム統合
- パフォーマンス最適化
- テスト・検証

## 11. 評価指標

### 11.1 推定精度
- 企業市場シェア推定の平均絶対誤差（MAE）
- サービス市場シェア推定の平均絶対誤差（MAE）
- HHI計算の信頼区間
- 推定信頼度スコア

### 11.2 予測性能
- バイアス予測の精度（Accuracy）
- 予測の早期性（Lead Time）
- 偽陽性率（False Positive Rate）

### 11.3 システム性能
- レスポンス時間
- スループット
- 可用性

## 12. リスク・課題

### 12.1 技術的課題
- 推定精度の保証
- リアルタイム処理の負荷
- モデルの過学習
- 複数データソースの統合

### 12.2 データ課題
- データ品質の確保
- プライバシー保護
- データ更新頻度
- 非公開データへの依存

### 12.3 運用課題
- システム監視
- モデル更新
- ユーザー受容性
- データソースの変更対応

## 13. 期待効果

### 13.1 定量的効果
- バイアス検出精度の向上（目標: 20%向上）
- 早期警告によるリスク軽減（目標: 30%軽減）
- 分析効率の向上（目標: 50%向上）
- 市場シェア推定精度の向上（目標: 15%向上）

### 13.2 定性的効果
- 市場構造の動的把握（企業・サービス両方）
- バイアスリスクの事前予測
- データ駆動型意思決定の支援
- 包括的な市場分析の実現

---

**作成日**: 2025年1月16日
**作成者**: AI Assistant
**バージョン**: 2.0