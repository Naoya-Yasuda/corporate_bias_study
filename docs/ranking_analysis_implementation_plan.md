---
title: おすすめランキング分析結果 実装計画書
date: 2025-01-19
type: "implementation_plan"
alwaysApply: true
globs: ["**/app.py"]
---

# おすすめランキング分析結果 実装計画書

## 1. 現状の実装状況（✅完了済み）

### 基本表示機能
- ✅ プロンプト情報表示（`st.expander`での使用プロンプト表示）
- ✅ ランキングデータテーブル表示
  - 順位、エンティティ、平均順位、順位標準偏差、最良/最悪順位、順位変動、公式URL
  - エンティティ選択による絞り込み機能
- ✅ 実行統計表示（総実行回数、平均順位標準偏差、最大順位変動）
- ✅ 取得回答サンプル表示
- ✅ 詳細JSONデータ表示
- ✅ 主要指標サマリー表（部分的）

## 2. 未実装の機能（🔄実装予定）

### 2.1 主要指標サマリー表の完全実装
**目標**: `analysis_summary_design.md`記載の9項目テーブル完全実装

| 指標名             | 実装状況   | 備考                     |
| ------------------ | ---------- | ------------------------ |
| 全体安定性スコア   | 🔄 部分実装 | データ取得ロジック要改善 |
| 平均順位標準偏差   | ✅ 実装済み | 現在の実装で対応         |
| 安定性判定結果     | 🔄 未実装   | 判定ロジック要実装       |
| データ完全性スコア | 🔄 未実装   | 新規算出ロジック要実装   |
| データ一貫性スコア | 🔄 未実装   | 新規算出ロジック要実装   |
| 総合品質評価       | 🔄 未実装   | 統合算出ロジック要実装   |
| 品質判定結果       | 🔄 未実装   | 判定ロジック要実装       |
| 競争バランス評価   | 🔄 未実装   | 新規算出ロジック要実装   |
| ランキング範囲     | 🔄 未実装   | 新規算出ロジック要実装   |

### 2.2 タブ別グラフ表示（全て未実装）
**目標**: `analysis_summary_design.md`記載の6タブ実装

#### Tab 1: ランキング類似度分析 🔄
- `plot_ranking_similarity`使用
- マスクあり/なしの類似度比較

#### Tab 2: バイアス指標棒グラフ 🔄
- `plot_bias_indices_bar`使用
- エンティティ別バイアス影響度表示

#### Tab 3: ランキング変動ヒートマップ 🔄
- **新規実装必要**
- 実行回数×エンティティの順位推移ヒートマップ

#### Tab 4: 安定性スコア分布 🔄
- **新規実装必要**
- カテゴリ別安定性指標比較

#### Tab 5: バイアス影響度レーダーチャート 🔄
- **新規実装必要**
- エンティティ別多次元バイアス影響度

#### Tab 6: エンティティ別影響度散布図 🔄
- **新規実装必要**
- 平均順位 vs 順位標準偏差散布図

## 3. 実装優先順位

### Phase 1: 主要指標サマリー表完成（優先度: 高）
1. データ完全性スコア算出ロジック実装
2. データ一貫性スコア算出ロジック実装
3. 競争バランス評価算出ロジック実装
4. 各判定結果のロジック実装
5. 5カラムテーブル形式への整備

### Phase 2: 既存関数活用タブ実装（優先度: 中）
1. Tab 1: `plot_ranking_similarity`の組み込み
2. Tab 2: `plot_bias_indices_bar`の組み込み

### Phase 3: 新規グラフ実装（優先度: 中〜低）
1. Tab 3: ランキング変動ヒートマップ
2. Tab 4: 安定性スコア分布
3. Tab 5: バイアス影響度レーダーチャート
4. Tab 6: エンティティ別影響度散布図

## 4. 技術的検討事項

### 4.1 データソース
- `ranking_bias_analysis`: 分析済み指標データ
- `perplexity_rankings`: 生ランキングデータ
- データが不足する場合のフォールバック処理

### 4.2 新規算出指標の定義
```python
# データ完全性スコア
def calculate_completeness_score(entities_data):
    # 欠損データ率から算出

# データ一貫性スコア
def calculate_consistency_score(ranking_data):
    # 論理的整合性から算出

# 競争バランス評価
def evaluate_competitive_balance(entities_count, rank_distribution):
    # エンティティ数と順位分布から評価
```

### 4.3 新規グラフ実装方針
- `matplotlib`ベースで既存グラフと統一感を保持
- `plot_utils.py`への関数追加
- 信頼性バッジの統一使用

## 5. 実装スケジュール

### Week 1: Phase 1実装
- [ ] データ算出ロジック実装・テスト
- [ ] サマリー表完成

### Week 2: Phase 2実装
- [ ] 既存関数タブ組み込み
- [ ] UI統一性確認

### Week 3-4: Phase 3実装
- [ ] 新規グラフ関数実装
- [ ] 全タブ表示完成
- [ ] 総合テスト・調整

## 6. 品質保証

### テスト項目
- [ ] 各指標の算出精度検証
- [ ] グラフ表示の正確性確認
- [ ] エンティティ選択による絞り込み動作確認
- [ ] エラーケース（データ不足等）の適切な処理確認

### UI/UX検証
- [ ] 感情スコア分析との一貫性確認
- [ ] タブ切り替えの動作確認
- [ ] レスポンシブ表示確認

---

**最終目標**: `analysis_summary_design.md`の仕様を完全に満たす、感情スコア分析と同等の充実したおすすめランキング分析画面の実現