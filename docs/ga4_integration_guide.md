# Google Analytics 4 (GA4) 統合ガイド

企業バイアス分析ダッシュボードにGoogle Analytics 4を統合する方法について説明します。

## 概要

このシステムでは、環境変数を使用してGA4の測定IDを設定することで、Webアプリケーションのアクセス解析を行うことができます。

## 設定方法

### 1. GA4測定IDの取得

1. [Google Analytics](https://analytics.google.com/)にアクセス
2. GA4プロパティを作成（まだない場合）
3. 管理 → データストリーム → ウェブを選択
4. 測定IDをコピー（例：`G-XXXXXXXXXX`）

### 2. 環境変数の設定

`.env`ファイルに以下を追加：

```bash
# Google Analytics 4設定
GA4_MEASUREMENT_ID=G-XXXXXXXXXX
```

**注意**: `.env_sample`ファイルを参考に、実際の測定IDを設定してください。

### 3. アプリケーションの起動

```bash
streamlit run app.py
```

## 機能

### 自動トラッキング

- **ページビュー**: ユーザーがページにアクセスした際に自動記録
- **セッション**: ユーザーのサイト滞在時間を追跡
- **ユーザー行動**: ページ間の移動パターンを分析

### ステータス確認

アプリケーションのサイドバーでGA4の動作状況を確認できます：

- ✅ **有効**: GA4が正常に動作中
- ❌ **無効**: 測定IDが未設定
- ⚠️ **エラー**: 測定IDの形式が不正

## トラブルシューティング

### GA4が動作しない場合

1. **環境変数の確認**
   ```bash
   echo $GA4_MEASUREMENT_ID
   ```

2. **測定ID形式の確認**
   - 正しい形式: `G-XXXXXXXXXX`
   - 間違った形式: `UA-XXXXXXXXX` (これはGA3の形式)

3. **ブラウザの開発者ツールで確認**
   - Network タブで `gtag/js` のリクエストを確認
   - Console タブでJavaScriptエラーがないか確認

### プライバシー設定

GA4を無効にしたい場合は、環境変数を削除または空にしてください：

```bash
# GA4を無効にする
GA4_MEASUREMENT_ID=
```

## セキュリティ

- 測定IDは公開情報のため、環境変数に設定しても問題ありません
- 個人情報や機密情報は収集されません
- OAuth認証と組み合わせて、認証されたユーザーのみ追跡されます

## カスタマイズ

より詳細な分析が必要な場合は、`src/utils/analytics_utils.py`を編集して以下を追加できます：

- カスタムイベント追跡
- eコマース追跡
- コンバージョン目標の設定

## サポート

GA4の詳細な使用方法については、[Google Analytics ヘルプ](https://support.google.com/analytics)を参照してください。

---

*最終更新: 2025年8月*