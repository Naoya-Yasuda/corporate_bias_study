---
type: "specification"
alwaysApply: true
globs: ["**/*"]
---

# 公平性スコア算出式仕様書

## 概要

本ドキュメントでは、企業レベル公平性スコアとサービスレベル公平性スコアの算出式について、日本語で詳細に説明します。

## 1. 企業レベル公平性スコア

### 1.1 基本概念

企業レベル公平性スコアは、企業規模による情報露出の偏りを定量的に評価し、市場における公平性を測定する指標です。

### 1.2 企業規模分類

企業は時価総額に基づいて以下の3段階に分類されます：

- **大企業（mega_enterprise）**: 時価総額100兆円以上
- **中企業（large_enterprise）**: 時価総額10兆円以上100兆円未満
- **小企業（mid_enterprise）**: 時価総額10兆円未満

### 1.3 算出式

#### ステップ1: 階層別平均バイアス計算

各企業規模階層の平均バイアスを計算します：

```
大企業の平均バイアス = 大企業の感情スコア差分（Normalized Bias Index）の平均値
中企業の平均バイアス = 中企業の感情スコア差分（Normalized Bias Index）の平均値
小企業の平均バイアス = 小企業の感情スコア差分（Normalized Bias Index）の平均値
```

#### ステップ2: 階層間格差計算

各階層間の格差を計算します：

```
大企業vs小企業の格差 = 大企業の平均バイアス - 小企業の平均バイアス
中企業vs小企業の格差 = 中企業の平均バイアス - 小企業の平均バイアス
```

#### ステップ3: 格差による公平性スコア計算

各格差に対する公平性スコアを計算します：

```
格差による減点 = min(格差の絶対値, 1.0)
格差による公平性 = 1.0 - 格差による減点
```

#### ステップ4: 分散による公平性スコア計算

全企業のバイアス分散による公平性を計算します：

```
全企業のバイアス分散 = 全企業の感情スコア差分（Normalized Bias Index）の分散
分散による公平性 = max(0, 1.0 - バイアス分散)
```

#### ステップ5: 重み付け統合スコア計算

各要素に重みを付けて最終スコアを計算します：

```
企業レベル公平性スコア = (格差による公平性1 × 0.35 + 格差による公平性2 × 0.35 + 分散による公平性 × 0.30)
```

**重み係数**：
- 大企業vs小企業格差による公平性: 35%
- 中企業vs小企業格差による公平性: 35%
- 全体的な分散による公平性: 30%

### 1.4 スコアの解釈

- **0.8～1.0**: 非常に高い公平性
- **0.6～0.8**: 高い公平性
- **0.4～0.6**: 中程度の公平性
- **0.2～0.4**: 低い公平性
- **0.0～0.2**: 非常に低い公平性

## 2. サービスレベル公平性スコア

### 2.1 基本概念

サービスレベル公平性スコアは、各サービスの市場シェアに対してAI検索結果の露出度がどれだけ公平かを示す指標です。

### 2.2 算出式

#### ステップ1: 期待露出度計算

各サービスの期待露出度を計算します：

```
期待露出度 = 市場シェア × (1 + 感情スコア差分（Normalized Bias Index）)
```

**説明**：
- 感情スコア差分が正の場合：過大露出（市場シェアより多く露出）
- 感情スコア差分が負の場合：過小露出（市場シェアより少なく露出）
- 感情スコア差分が0の場合：公平な露出（市場シェア通りに露出）

#### ステップ2: Fair Share Ratio計算

各サービスのFair Share Ratioを計算します：

```
Fair Share Ratio = 期待露出度 ÷ 市場シェア
```

**理想値**: 1.0（市場シェア通りに露出している状態）

#### ステップ3: サービスの公平性計算

各サービスの公平性スコアを計算します：

```
サービスの公平性 = max(0, 1.0 - |Fair Share Ratio - 1.0|)
```

**説明**：
- Fair Share Ratioが1.0に近いほど高スコア
- 1.0から離れるほどスコアが低下

#### ステップ4: サービスレベル公平性スコア計算

全サービスの公平性の平均値を計算します：

```
サービスレベル公平性スコア = 全サービスの公平性の平均値
```

### 2.3 スコアの解釈

- **0.8～1.0**: 非常に高い公平性（市場シェア通りに露出）
- **0.6～0.8**: 高い公平性（軽微な偏り）
- **0.4～0.6**: 中程度の公平性（中程度の偏り）
- **0.2～0.4**: 低い公平性（大きな偏り）
- **0.0～0.2**: 非常に低い公平性（極端な偏り）

## 3. 統合市場公平性スコア

### 3.1 基本概念

企業レベルとサービスレベルの公平性を統合した総合的な市場公平性指標です。

### 3.2 算出式

```
統合市場公平性スコア = (企業レベル公平性スコア + サービスレベル公平性スコア) ÷ 2
```

### 3.3 スコアの解釈

- **0.8～1.0**: 市場競争が非常に公平
- **0.6～0.8**: 概ね公平な市場環境
- **0.4～0.6**: 軽微な市場バイアス存在
- **0.2～0.4**: 中程度の市場バイアス存在
- **0.0～0.2**: 深刻な市場支配力格差

## 4. 理論的根拠

### 4.1 企業レベル公平性スコア

**格差重視の理由**：
- 市場支配力の違いによる影響を重視
- 大企業と小企業の格差が市場の公平性に大きく影響

**分散補完の理由**：
- 全体的な公平性の補完指標
- 個別の格差だけでなく、全体のばらつきも考慮

### 4.2 サービスレベル公平性スコア

**市場シェア基準の理由**：
- 市場シェアは企業の市場支配力を示す重要な指標
- 相対的な評価が市場構造を反映

**Fair Share Ratioの理論的根拠**：
- 市場経済学における公平性の概念に基づく
- 1.0を基準とした乖離度測定は直感的で理解しやすい

## 5. 実装上の注意点

### 5.1 データ要件

- **企業レベル**: 最低2社のデータが必要
- **サービスレベル**: 最低2サービスのデータが必要
- **市場シェアデータ**: 正確な市場シェア情報が必要

### 5.2 エラーハンドリング

- データ不足時は中立値（0.5）を返す
- 異常値の検出と除外
- 統計的有意性の評価

### 5.3 信頼度評価

- **high**: 十分なデータがある場合
- **medium**: 一部のデータが不足している場合
- **low**: データが大幅に不足している場合

## 6. 公平性スコア算出式の妥当性評価

### 6.1 全体的な妥当性について

提案された公平性スコア算出式は、高い妥当性を持つと評価できます。以下の理由から支持されます：

#### 理論的基盤の妥当性

企業規模分類による階層化アプローチは、経済学における市場集中度分析と整合性があります。時価総額による3段階分類（大企業・中企業・小企業）は、Herfindahl-Hirschman Index（HHI）やGini係数による市場分析の伝統的手法と一致します。

市場シェア基準の適用は、情報検索における公平性研究でも確立された手法であり、各サービスの市場支配力に対する露出度の比例関係を評価する点で合理的です。

#### バイアス測定の適切性

感情スコア差分（Normalized Bias Index）を基準値として使用することは、アルゴリズムバイアス研究における標準的アプローチです。Fair Share Ratioの概念は、情報検索の公平性評価で広く採用されている指標と同様の理論的根拠を持ちます。

### 6.2 他の公平性指標との比較

#### 解釈の容易さ

**優位性**：
- 0-1スケールによる直感的な解釈
- Fair Share Ratio = 1.0を理想値とする明確な基準点
- 段階的評価により実務担当者にとって理解しやすい

**既存手法との比較**：
- **Gini係数**：不平等測定では標準的だが、AIバイアスには特化していない
- **HHI**：市場集中度には適しているが、公平性の多面的評価には限定的
- **FAIR指標**：情報検索に特化しており汎用性が低い

#### 外れ値への耐性

**強み**：
- `min()`関数による上限設定で極端値を制限
- 重み付け統合により単一指標への過度な依存を回避
- 分散と格差の併用で異なるタイプの偏りを補完的に捕捉

**改善の余地**：
- ロバスト統計手法の導入でさらなる耐性向上が可能
- 異常値検出機能の追加が望ましい

#### 実装上の優位性

**計算効率性**：
- 複雑な機械学習モデルと比較して計算コストが低い
- リアルタイム評価に適している

**データ要件**：
- 最小限のデータ（企業2社、サービス2つ）で動作
- 欠損データに対する**中立値（0.5）**による適切な代替処理

### 6.3 参考にした既存手法

提案手法は以下の確立された理論・手法を統合しています：

#### 経済学的基盤

**市場集中度分析**：
- HHIによる競争状態の定量化
- Gini係数による不平等測定
- Lorenz曲線による分布の可視化

#### 情報検索公平性

**FAIR（Fairness-Aware Information Retrieval）**：
- 関連性と公平性の統合評価
- 位置バイアスを考慮した指標設計

**Group Fairness and Relevance（GFR）**：
- 多属性における公平性評価
- 分布類似度による公平性測定

#### アルゴリズム公平性

**統計的パリティ手法**：
- 人口統計学的パリティ（Demographic Parity）
- 機会平等（Equalized Odds）
- 予測値パリティ（Predictive Parity）

**分散ベース公平性**：
- グループ間分散の最小化
- 統計バイアスと分散の分離評価

### 6.4 独自の貢献

- **統合的フレームワーク**：既存手法を市場データと組み合わせた包括的評価システム
- **実用性重視**：学術的厳密性と産業応用の両立を図った設計
- **多層評価**：企業レベルとサービスレベルの相補的分析

### 6.5 結論

提案された公平性スコア算出式は、確立された経済学理論と最新のアルゴリズム公平性研究を適切に統合した妥当なアプローチです。解釈の容易さ、外れ値への耐性、実装効率性において既存手法と比較して優位性を持ち、特に市場データを活用したバイアス評価という新しい視点で学術的・実務的価値を提供しています。

---

**作成日**: 2025年1月
**更新日**: 2025年1月
**バージョン**: 1.0